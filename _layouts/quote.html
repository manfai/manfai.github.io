<!DOCTYPE html>
<html data-theme="corporate" lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Quote</title>

    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon-16x16.png">
    <link rel="manifest" href="/assets/images/site.webmanifest">
    <link rel="mask-icon" href="/assets/images/safari-pinned-tab.svg" color="#5bbad5">

    <link href="http://fonts.cdnfonts.com/css/roboto" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2/dist/tailwind.min.css" rel="stylesheet" type="text/css" />
	<link href="https://cdn.jsdelivr.net/npm/daisyui@1.14.3/dist/full.css" rel="stylesheet" type="text/css" />
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<style>
		@media print {
		/* body * { display:none; } */
		#main #quote * { display:block; }
		}
	</style>
</head>
<body class="bg-base-300 p-10">
	
	<main id="quote" class="shadow min-w-max mx-auto max-w-5xl flex flex-wrap items-stretch bg-base-100 min-h-screen">

		<aside class="w-32 text-transform">
			<h2 class="transform origin-bottom-center mt-96 ml-16 text-3xl font-light space-x-5 -rotate-90 uppercase flex">
				<span class="text-gray-500">quote</span>
				<span class="text-primary">
					#{{page.id_number}}
				</span>
			</h2>
		</aside>

		<section class="flex-auto relative flex-col pt-10 pr-10 pl-5">
			<table class="w-full">
				<thead>
					<tr>
						<td colspan="2" class="align-top">
							<div class="content-start">
								<h3 class="text-3xl font-normal text-primary">{{ page.title }}</h3>
								<p class="text-sm">manfai.me</p>
								<p class="text-sm">manfai106@gmail.com</p>
								<p class="text-sm">+852 98792217</p>
							</div>
						</td>
						<td class="grid justify-items-end">
							<img src="/assets/images/logo.webp" width="200px" class="pb-5">
						</td>
					</tr>
				</thead>
				<tbody>
					<tr class="h-20 align-top">
						<td>
							<div class="pr-10">
								<h4 class="text-primary">Bill to</h4>
								<hr class="text-primary">
								<p class="text-sm">Mann Man</p>
								<p class="text-sm">manfai106@gmail.com</p>
								<p class="text-sm">+852 98792217</p>
							</div>
						</td>
						<td>
							<div class="pr-10">
								<h4 class="text-primary">Ship to</h4>
								<hr class="text-primary">
								<p class="text-sm">Mann Man</p>
								<p class="text-sm">manfai106@gmail.com</p>
								<p class="text-sm">+852 98792217</p>
							</div>
						</td>
						<td>
							<div>
								<p>Quote Date: <b class="font-semibold">{{ page.date | date: "%m/%d/%Y"}}</b></p>
								<p>Valid For: <b class="font-semibold">15 Days</b></p>
								<p></p>
							</div>
						</td>
					</tr>
				</tbody>
			</table>

			<table class="w-full table-auto table-compact mt-20">
				<thead class="font-semibold bg-primary text-white text-center">
					<tr>
						<th class="border border-gray-800">DESCRIPTION</th>
						<th class="border border-gray-800">QTY</th>
						<th class="border border-gray-800">UNIT PRICE</th>
						<th class="border border-gray-800">TOTAL</th>
					</tr>
				</thead>
				<tbody>
                    {% assign subtotal = 0 %}
                    {% for item in page.items %}
                    <tr class="{{ forloop.index | modulo:2 | plus:1 | replace: '2', 'odd' | replace: '1', 'bg-gray-100'}}">
						<td class="border">{{item.description}}</td>
						<td class="border text-center">{{item.qty}}</td>

                        {% assign price = item.price %}
                        {% assign price_split = price | round: 2 | split: "." %}
                        {% assign integral = price_split[0] %}
                        {% assign fractional = price_split[1] | append: "00" | truncate: 2, "" %}
						<td class="border text-center">{{ integral }}.{{ fractional }}</td>

                        {% assign price = item.qty | times:item.price %}
                        {% assign price_split = price | round: 2 | split: "." %}
                        {% assign integral = price_split[0] %}
                        {% assign fractional = price_split[1] | append: "00" | truncate: 2, "" %}
						<td class="border text-right">{{ integral }}.{{ fractional }}</td>
					</tr>
                    {% assign subtotal = subtotal | plus: price %}
                    {% endfor %}

                    {% assign row = 10 %}
                    {% if page.items.size < row %}
                        {% assign value = row| minus: page.items.size %}
                        {% assign even = page.items.size | modulo:2 | plus:1 | replace: '1', 'bg-gray-100' | replace: '2', '' %}
                        {% assign odd  = page.items.size | modulo:2 | plus:1 | replace: '1', '' | replace: '2', 'bg-gray-100' %}
                        {% for item in (1..value) %}
                        <tr class="{{ forloop.index | modulo:2 | plus:1 | replace: '1', even | replace: '2', odd}}">
                            <td class="border"></td>
                            <td class="border text-center"></td>
                            <td class="border text-center"></td>
                            <td class="border text-right">0.00</td>
                        </tr>
                        {% endfor %}
                    {% endif %}
					
				</tbody>
				<tfoot>
					<tr>
						<td rowspan="7" colspan="2" class="text-left">
							<h3 class="text-md">Thank you for your business! ü§ù</h3>	
						</td>
						<td class="text-right font-medium tracking-tighter">
							<h5 class="text-xs">SUBTOTAL</h5>
						</td>
                        {% assign price = subtotal %}
                        {% assign price_split = price | round: 2 | split: "." %}
                        {% assign integral = price_split[0] %}
                        {% assign fractional = price_split[1] | append: "00" | truncate: 2, "" %}
						
						<td class="border-b text-right">
                            <p class="text-xs">   {{ integral }}.{{ fractional }}
                                </p>
                            </td>
					</tr>
					<tr>
						<td class="text-right font-medium tracking-tighter">
							<h5 class="text-xs">DISCOUNT</h5>
						</td>
                        {% assign price = page.discount %}
                        {% assign price_split = price | round: 2 | split: "." %}
                        {% assign integral = price_split[0] %}
                        {% assign fractional = price_split[1] | append: "00" | truncate: 2, "" %}
						<td class="border-b text-right">
                            <p class="text-xs">   {{ integral }}.{{ fractional }}
                                </p>
                            </td>
					</tr>
					<tr>
						<td class="text-right font-medium tracking-tighter">
							<h5 class="text-xs">SUBTOTAL LESS DISCOUNT</h5>
						</td>
						<td class="border-b text-right">
                            <p class="text-xs">   0.00
                                </p>
                            </td>
					</tr>
					<tr>
						<td class="text-right font-medium tracking-tighter">
							<h5 class="text-xs">TAX RATE</h5>
						</td>
                        {% assign price = page.tax_rate %}
                        {% assign price_split = price | round: 2 | split: "." %}
                        {% assign integral = price_split[0] %}
						<td class="border-b text-right">
                            <p class="text-xs">   {{ integral }}%
                                </p>
                            </td>
					</tr>
					<tr>
						<td class="text-right font-medium tracking-tighter">
							<h5 class="text-xs">TOTAL TAX</h5>
						</td>
						<td class="border-b text-right">
                            <p class="text-xs">   0.00
                                </p>
                            </td>
					</tr>
					<tr>
						<td class="text-right font-medium tracking-tighter">
							<h5 class="text-xs">SHIPPING/HANDLING</h5>
						</td>
						<td class="border-b text-right">
                            <p class="text-xs">   {{ page.shipping }}
                                </p>
                            </td>
					</tr>
					<tr class="font-bold">
						<td class="text-right border-t">
							<h5 class="text-base text-primary">
								Quote Total</h5>	
						</td>
						<td class="border-b border-t">
							<h5 class="text-lg text-right">$ <span>{{subtotal|plus:page.shipping|minus:page.discount}}</span></h5>
						</td>
					</tr>
				</tfoot>
			</table>

			<footer class="w-full block px-3 pt-20 pb-10 justify-self-start">
				<h6 class="text-sm text-primary">Terms & Instructions</h6>
				<hr class="text-primary">
				<p class="text-xs">Make all payments payable to my FPS account +852 98792217</p>	
				<p class="text-xs">Total due in 15 days. Overdue accounts subject to a service charge of 1% per week.</p>	
			</footer>
		</section>
	
	</main>

    <div class="flex pt-10 m-auto text-center min-w-max max-w-4xl">
        <button class="mx-auto btn btn-primary" onclick="generatePDF()">
            Download
        </button>
    </div>

    <script>
        function generatePDF() {
			const element = document.getElementById('quote');
			const parsed = parseInt(element.offsetHeight, 10);
			// alert(parsed/96);

            // Choose the element that our invoice is rendered in.
            let doc_width = 8.27;  // A4 measures 210 √ó 297 millimeters or 8.27 √ó 11.69 inches
            // let doc_height = (parsed/96) + 5;
            let doc_height = 11.69;
            let aspect = doc_height / doc_width;
            let dpi = 120; // targeting ~1200 window width
            let img_width = doc_width * dpi;
            let img_height = doc_height * dpi;
            let win_width = img_width;
            let win_height = img_height;

    
            var opt = {
                margin:       [0.01, 0.01, 0.01, 0.01],
                filename:     'myfile.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 8,   // equals 1
                                scrollX: 0, 
								scrollY: 0,
								// useCORS: true,
                                // width: img_width,
                                // height: img_height,
								// windowHeight: doc_height * 96 - 3
                                // windowWidth: win_width
                              },
                jsPDF:        { orientation: 'portrait',
                                unit: 'in',
                                format: [doc_width, doc_height]
                              }
            };
            // Choose the element and save the PDF for our user.
            html2pdf().set(opt).from(element).save();
        }
    </script>
</body>
</html>